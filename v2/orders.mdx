---
title: Orders
description: Complete reference for the Order model, items, addresses, shipping, refunds, and order management in Shopper.
---

Orders represent customer purchases and are central to your e-commerce operations. Shopper provides a comprehensive order management system with support for items, addresses, shipping, refunds, and status tracking.

## Models

Shopper uses five models to manage orders:

```php
Shopper\Core\Models\Order          // The main order
Shopper\Core\Models\OrderItem      // Products in the order
Shopper\Core\Models\OrderAddress   // Billing and shipping addresses
Shopper\Core\Models\OrderShipping  // Shipping and tracking information
Shopper\Core\Models\OrderRefund    // Refund requests
```

```php
use Shopper\Core\Models\Order;

// The model implements
- Shopper\Core\Models\Contracts\Order

// Uses traits
- SoftDeletes
```

### Extending the Model

```php
namespace App\Models;

use Shopper\Core\Models\Order as BaseOrder;

class Order extends BaseOrder
{
    // Add your customizations here
}
```

Update `config/shopper/models.php`:

```php
return [
    'order' => \App\Models\Order::class,
];
```

## Database Schema

### Order Table

| Column | Type | Nullable | Default | Description |
|--------|------|----------|---------|-------------|
| `id` | bigint | no | auto | Primary key |
| `number` | string(32) | no | - | Order number |
| `price_amount` | integer | yes | null | Order price override (in cents) |
| `status` | string(32) | no | pending | Order status enum |
| `currency_code` | string | no | - | Currency code (USD, EUR, etc.) |
| `notes` | text | yes | null | Order notes |
| `parent_order_id` | bigint | yes | null | FK to parent order |
| `payment_method_id` | bigint | yes | null | FK to payment method |
| `channel_id` | bigint | yes | null | FK to channel |
| `customer_id` | bigint | yes | null | FK to user |
| `zone_id` | bigint | yes | null | FK to zone |
| `billing_address_id` | bigint | yes | null | FK to order address |
| `shipping_address_id` | bigint | yes | null | FK to order address |
| `shipping_option_id` | bigint | yes | null | FK to carrier option |
| `cancelled_at` | timestamp | yes | null | Cancellation date |
| `deleted_at` | timestamp | yes | null | Soft delete timestamp |
| `created_at` | timestamp | yes | null | Creation timestamp |
| `updated_at` | timestamp | yes | null | Last update timestamp |

### OrderItem Table

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | bigint | no | Primary key |
| `name` | string | yes | Product name at time of purchase |
| `sku` | string | yes | Product SKU at time of purchase |
| `quantity` | integer | no | Quantity ordered |
| `unit_price_amount` | integer | no | Unit price (in cents) |
| `product_id` | bigint | no | Polymorphic relation ID |
| `product_type` | string | no | Polymorphic relation type |
| `order_id` | bigint | no | FK to order |
| `order_shipping_id` | bigint | yes | FK to order_shipping (shipment) |
| `fulfillment_status` | string | yes | Fulfillment status enum value |

### OrderAddress Table

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | bigint | no | Primary key |
| `customer_id` | bigint | no | FK to user |
| `first_name` | string | no | First name |
| `last_name` | string | no | Last name |
| `company` | string | yes | Company name |
| `street_address` | string | no | Street address |
| `street_address_plus` | string | yes | Additional address line |
| `postal_code` | string | no | Postal/ZIP code |
| `city` | string | no | City |
| `state` | string | yes | State/province/region |
| `phone` | string | yes | Phone number |
| `country_name` | string | yes | Country name |

### OrderShipping Table

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | bigint | no | Primary key |
| `shipped_at` | datetime | no | Shipment date |
| `received_at` | datetime | yes | Delivery date |
| `returned_at` | datetime | yes | Return date |
| `tracking_number` | string | yes | Carrier tracking number |
| `tracking_url` | string | yes | Tracking URL |
| `voucher` | json | yes | Shipping voucher data |
| `order_id` | bigint | no | FK to order |
| `carrier_id` | bigint | yes | FK to carrier |

### OrderRefund Table

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | bigint | no | Primary key |
| `refund_reason` | string | yes | Refund reason |
| `refund_amount` | integer | yes | Refund amount (in cents) |
| `status` | string | no | Refund status enum |
| `currency` | string | no | Currency code |
| `notes` | string | yes | Admin notes |
| `order_id` | bigint | no | FK to order |
| `user_id` | bigint | yes | FK to user processing refund |

## Order Status

The `OrderStatus` enum defines available order states:

```php
use Shopper\Core\Enum\OrderStatus;

OrderStatus::New        // new
OrderStatus::Pending    // pending (default)
OrderStatus::Register   // registered
OrderStatus::Paid       // paid
OrderStatus::Shipped    // shipped
OrderStatus::Delivered  // delivered
OrderStatus::Completed  // completed
OrderStatus::Cancelled  // cancelled
OrderStatus::Archived   // archived
```

| Status | Database Value | Color | Description |
|--------|---------------|-------|-------------|
| New | `new` | info | Newly placed order |
| Pending | `pending` | warning | Awaiting processing |
| Register | `registered` | primary | Order registered |
| Paid | `paid` | green | Payment received |
| Shipped | `shipped` | indigo | Order shipped |
| Delivered | `delivered` | sky | Order delivered |
| Completed | `completed` | teal | Order fulfilled |
| Cancelled | `cancelled` | danger | Order cancelled |
| Archived | `archived` | gray | Order archived |

### Status Check Methods

```php
$order->isPending();     // true if status is Pending
$order->isRegister();    // true if status is Register
$order->isPaid();        // true if status is Paid
$order->isShipped();     // true if status is Shipped
$order->isCompleted();   // true if status is Completed
$order->isNotCancelled(); // true if status is NOT Cancelled
$order->canBeCancelled(); // true if Completed or New
```

## Fulfillment Status

The `FulfillmentStatus` enum tracks individual item fulfillment, enabling partial shipments and multi-carrier delivery:

```php
use Shopper\Core\Enum\FulfillmentStatus;

FulfillmentStatus::Pending              // pending
FulfillmentStatus::ForwardedToSupplier  // forwarded_to_supplier (dropshipping)
FulfillmentStatus::Processing           // processing
FulfillmentStatus::Shipped              // shipped
FulfillmentStatus::Delivered            // delivered
FulfillmentStatus::Cancelled            // cancelled
```

| Status | Database Value | Color | Description |
|--------|---------------|-------|-------------|
| Pending | `pending` | warning | Awaiting processing |
| Forwarded to Supplier | `forwarded_to_supplier` | info | Sent to external supplier (dropshipping) |
| Processing | `processing` | primary | Being prepared |
| Shipped | `shipped` | indigo | In transit |
| Delivered | `delivered` | success | Received by customer |
| Cancelled | `cancelled` | danger | Fulfillment cancelled |

<Note>
`FulfillmentStatus` is applied per **item**, not per order. This allows partial fulfillment when items ship at different times or from different carriers. See the [Fulfillment](/v2/fulfillment) page for complete workflows.
</Note>

## Refund Status

The `OrderRefundStatus` enum defines refund states:

```php
use Shopper\Core\Enum\OrderRefundStatus;

OrderRefundStatus::Pending        // pending (default)
OrderRefundStatus::Awaiting       // awaiting
OrderRefundStatus::Treatment      // treatment
OrderRefundStatus::Partial_Refund // partial_refund
OrderRefundStatus::Refunded       // refunded
OrderRefundStatus::Rejected       // rejected
OrderRefundStatus::Cancelled      // cancelled
```

## Relationships

### Customer

```php
// Get the customer who placed the order
$order->customer; // Returns User model

// Query orders by customer
Order::query()
    ->where('customer_id', $userId)
    ->get();
```

### Items

```php
// Get all items in the order
$order->items; // Collection of OrderItem models

// Add an item
$order->items()->create([
    'name' => $product->name,
    'sku' => $product->sku,
    'quantity' => 2,
    'unit_price_amount' => $product->price_amount,
    'product_id' => $product->id,
    'product_type' => get_class($product),
]);

// Get item total (computed)
$item->total; // unit_price_amount * quantity
```

### Addresses

```php
// Get shipping address
$order->shippingAddress; // OrderAddress model

// Get billing address
$order->billingAddress; // OrderAddress model

// Access full name
$order->shippingAddress->full_name; // "John Doe"
```

### Shipping

```php
// Get the shipping option selected at checkout
$order->shippingOption; // CarrierOption model

// Get all shipments for an order
$order->shippings; // Collection of OrderShipping models

// Create a shipment
$shipment = $order->shippings()->create([
    'carrier_id' => $carrierId,
    'shipped_at' => now(),
    'tracking_number' => 'TRACK123456',
    'tracking_url' => 'https://carrier.com/track/TRACK123456',
]);

// Link items to the shipment
$order->items()
    ->whereIn('id', [$itemId1, $itemId2])
    ->update([
        'order_shipping_id' => $shipment->id,
        'fulfillment_status' => FulfillmentStatus::Shipped,
    ]);
```

### Item Shipment

```php
// Get the shipment for a specific item
$item->shipment; // OrderShipping model (nullable)

// Get the carrier for an item's shipment
$item->shipment?->carrier; // Carrier model

// Get all items in a shipment
$shipment->items; // Collection of OrderItem models
```

<Note>
For complete multi-shipment and dropshipping workflows, see the [Fulfillment](/v2/fulfillment) page.
</Note>

### Refund

```php
// Get order refund
$order->refund; // OrderRefund model (HasOne)

// Create a refund
$order->refund()->create([
    'refund_reason' => 'Product damaged',
    'refund_amount' => $order->total(),
    'currency' => $order->currency_code,
    'status' => OrderRefundStatus::Pending,
]);
```

### Channel and Zone

```php
// Get sales channel
$order->channel; // Channel model

// Get zone (market)
$order->zone; // Zone model
```

### Parent/Child Orders

```php
// Get parent order (for split orders)
$order->parent; // Order model

// Get child orders
$order->children; // Collection of Order models
```

## Computed Values

### Order Total

```php
// Get order total from items
$order->total(); // Sum of all item totals (in cents)

// Get total as Price object
$order->total_amount; // Price object with formatting
```

## Events

Order lifecycle events are dispatched via the `OrderObserver`:

```php
use Shopper\Core\Events\Orders\OrderCreated;
use Shopper\Core\Events\Orders\OrderDeleted;
use Shopper\Core\Events\Orders\OrderCompleted;
use Shopper\Core\Events\Orders\OrderPaid;
use Shopper\Core\Events\Orders\OrderRegistered;
use Shopper\Core\Events\Orders\OrderCancel;
use Shopper\Core\Events\Orders\OrderArchived;
use Shopper\Core\Events\Orders\AddNoteToOrder;
```

### Listening to Events

```php
// In your EventServiceProvider
protected $listen = [
    OrderCreated::class => [
        SendOrderConfirmationEmail::class,
        NotifyAdminOfNewOrder::class,
    ],
    OrderCompleted::class => [
        SendOrderCompletedEmail::class,
        UpdateInventory::class,
    ],
    OrderPaid::class => [
        GenerateInvoice::class,
    ],
];
```

### Event Payload

```php
// All order events contain the order instance
class OrderCompleted implements ShouldQueueAfterCommit
{
    public function __construct(
        public Order $order
    ) {}
}
```

## Creating Orders

### Basic Order

```php
use Shopper\Core\Models\Order;
use Shopper\Core\Enum\OrderStatus;

$order = Order::query()->create([
    'number' => generate_number(),
    'customer_id' => auth()->id(),
    'currency_code' => current_currency(),
    'channel_id' => $channelId,
    'status' => OrderStatus::New,
]);
```

### Complete Order with Items and Addresses

```php
// Create addresses
$shippingAddress = OrderAddress::query()->create([
    'customer_id' => auth()->id(),
    'first_name' => 'John',
    'last_name' => 'Doe',
    'street_address' => '123 Main St',
    'city' => 'New York',
    'postal_code' => '10001',
    'country_name' => 'United States',
    'phone' => '+1234567890',
]);

$billingAddress = OrderAddress::query()->create([
    'customer_id' => auth()->id(),
    'first_name' => 'John',
    'last_name' => 'Doe',
    'street_address' => '123 Main St',
    'city' => 'New York',
    'postal_code' => '10001',
    'country_name' => 'United States',
]);

// Create order
$order = Order::query()->create([
    'number' => generate_number(),
    'customer_id' => auth()->id(),
    'currency_code' => 'USD',
    'shipping_address_id' => $shippingAddress->id,
    'billing_address_id' => $billingAddress->id,
    'shipping_option_id' => $carrierOptionId,
    'zone_id' => $zoneId,
]);

// Add items from cart
foreach ($cart->items as $cartItem) {
    $order->items()->create([
        'name' => $cartItem->product->name,
        'sku' => $cartItem->product->sku,
        'quantity' => $cartItem->quantity,
        'unit_price_amount' => $cartItem->product->price_amount,
        'product_id' => $cartItem->product->id,
        'product_type' => get_class($cartItem->product),
    ]);
}
```

## Retrieving Orders

```php
use Shopper\Core\Models\Order;

// Get all orders with relationships
$orders = Order::query()
    ->with(['customer', 'items', 'shippingAddress'])
    ->latest()
    ->get();

// Get orders by status
$pendingOrders = Order::query()
    ->where('status', OrderStatus::Pending)
    ->get();

// Get customer's orders
$customerOrders = Order::query()
    ->where('customer_id', $customerId)
    ->with('items.product')
    ->latest()
    ->paginate(10);

// Get order by number
$order = Order::query()
    ->where('number', $orderNumber)
    ->with(['items', 'shippingAddress', 'billingAddress', 'refund'])
    ->firstOrFail();

// Get orders for a channel
$channelOrders = Order::query()
    ->where('channel_id', $channelId)
    ->get();

// Get orders for a zone
$zoneOrders = Order::query()
    ->where('zone_id', $zoneId)
    ->get();
```

## Order Number Generation

Use the `generate_number()` helper to create unique order numbers:

```php
$orderNumber = generate_number();
// Returns something like: "ORD-20240115-001234"
```

## Components

```bash
php artisan shopper:component:publish order
```

Creates `config/shopper/components/order.php`:

```php
use Shopper\Livewire;

return [
    'pages' => [
        'order-index' => Livewire\Pages\Order\Index::class,
        'order-detail' => Livewire\Pages\Order\Detail::class,
    ],
    'components' => [
        //
    ],
];
```

## Storefront Example

```php
namespace App\Http\Controllers;

use Shopper\Core\Models\Order;
use Shopper\Core\Models\OrderAddress;
use Shopper\Core\Enum\OrderStatus;

class CheckoutController extends Controller
{
    public function store(Request $request)
    {
        $validated = $request->validate([
            'shipping.first_name' => 'required|string',
            'shipping.last_name' => 'required|string',
            'shipping.street_address' => 'required|string',
            'shipping.city' => 'required|string',
            'shipping.postal_code' => 'required|string',
            'shipping_option_id' => 'required|exists:carrier_options,id',
        ]);

        // Create shipping address
        $shippingAddress = OrderAddress::query()->create([
            'customer_id' => auth()->id(),
            ...$validated['shipping'],
        ]);

        // Create order
        $order = Order::query()->create([
            'number' => generate_number(),
            'customer_id' => auth()->id(),
            'currency_code' => current_currency(),
            'shipping_address_id' => $shippingAddress->id,
            'billing_address_id' => $shippingAddress->id,
            'shipping_option_id' => $validated['shipping_option_id'],
            'channel_id' => current_channel()->id,
        ]);

        // Add cart items
        foreach (Cart::items() as $item) {
            $order->items()->create([
                'name' => $item->product->name,
                'sku' => $item->product->sku,
                'quantity' => $item->quantity,
                'unit_price_amount' => $item->product->price_amount,
                'product_id' => $item->product->id,
                'product_type' => get_class($item->product),
            ]);
        }

        Cart::clear();

        return redirect()->route('orders.show', $order);
    }

    public function show(Order $order)
    {
        abort_unless($order->customer_id === auth()->id(), 403);

        return view('orders.show', [
            'order' => $order->load(['items.product', 'shippingAddress']),
        ]);
    }
}
```

## Order Status Flow

| From Status | Possible Transitions |
|-------------|---------------------|
| New | Pending, Cancelled |
| Pending | Register, Paid, Cancelled |
| Register | Paid, Cancelled |
| Paid | Shipped |
| Shipped | Delivered |
| Delivered | Completed |
| Completed | Archived |
| Cancelled | (terminal state) |
